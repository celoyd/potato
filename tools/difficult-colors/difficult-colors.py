import torch
from potato.color import BandsToOklab, OklabTosRGB
from potato.util import pile

full_edge = 512


b2l = BandsToOklab()
l2r = OklabTosRGB()

colors = {
    "classic blue roofs": (2172.3125, [1954, 2761, 1530, 1067, 1757, 4503, 4574, 4490]),
    "blue roof 2": (1996.6875, [1996, 2901, 1731, 1073, 1878, 4386, 4375, 4489]),
    "rust on blue roof": (1221.5, [539, 965, 959, 993, 1277, 2465, 2927, 3190]),
    "blue roof ridgeline": (2454.0, [1855, 2758, 1879, 1539, 2226, 4276, 4276, 4074]),
    "more blue roof": (2476.9375, [2565, 3456, 1734, 1149, 2038, 4600, 4720, 4648]),
    "red roof": (3392.3125, [756, 822, 1021, 4080, 5675, 5714, 5237, 4910]),
    "blue field": (405.25, [593, 911, 546, 349, 380, 459, 1408, 1661]),
    "giant flames": (8302.3125, [691, 801, 1005, 2072, 5296, 9995, 8654, 9999]),
    "dark tarp": (691.1875, [1482, 1782, 536, 390, 641, 831, 4494, 5367]),
    "medium tarp": (1383.875, [3102, 3974, 1283, 879, 970, 1210, 6200, 8096]),
    "bank roof": (938.5, [1381, 1895, 1067, 764, 1102, 1454, 1596, 1795]),
    "bright tarp": (2756.375, [3708, 4514, 2548, 2286, 2395, 2862, 6794, 8674]),
    "another blue roof": (681.125, [1537, 2063, 813, 523, 589, 713, 1784, 1862]),
    "off-white roof": (4003.0, [4177, 5185, 3932, 3233, 3728, 5568, 6284, 6470]),
    "rich red roof": (1427.625, [197, 503, 654, 1396, 1945, 2626, 2587, 2790]),
    "tarp roof": (658.8125, [1104, 1422, 739, 414, 555, 639, 2150, 2737]),
    "pool water": (779.5, [1592, 1997, 1958, 865, 624, 285, 143, 106]),
    "hotish orange roof": (
        2670.9375,
        [328, 437, 569, 3325, 4936, 5298, 5664, 6164],
    ),
    "dusty/faded blue": (
        2875.5625,
        [2843, 3381, 2811, 2694, 2809, 3839, 3813, 4282],
    ),
    "less dusty/faded": (2336.625, [3122, 3282, 2127, 1894, 2129, 3774, 4087, 4731]),
    "depot roof": (992.625, [1387, 1897, 1212, 1037, 1003, 1047, 1934, 2384]),
    "greenish roof": (822.1875, [622, 1214, 1185, 621, 645, 1189, 1522, 1617]),
    "ischool blue": (
        1001.0,
        [1359, 1732, 1091, 827, 1000, 1161, 2395, 2712],
    ),
    "bricky red roof": (1787.375, [309, 738, 907, 1821, 2574, 3452, 2998, 3362]),
    "Niigata pool": (5348.5, [2889, 4886, 3333, 2091, 5149, 9533, 9504, 9408]),
    "Niigata pool 2": (3260.4375, [2380, 3680, 2466, 1889, 3439, 6435, 6224, 5988]),
    "Tana jaca": (1461.8125, [806, 1138, 525, 741, 1570, 2645, 3414, 3776]),
    "Tana jaca 2": (1591.8125, [929, 868, 606, 748, 1513, 2541, 3032, 2944]),
    "wharf": (2597.1875, [3401, 3735, 2122, 1467, 2530, 3749, 3528, 3643]),
    "wharf shade": (378.5, [649, 580, 296, 243, 337, 395, 308, 368]),
    "ONE box": (2781.3125, [1673, 1164, 791, 2148, 3150, 3306, 3425, 4110]),
    "dusty roof": (2700.0625, [2188, 2084, 1474, 1286, 1960, 5283, 5173, 5006]),
    "dusty ridgeline": (886.5, [765, 900, 494, 510, 721, 1631, 1538, 1589]),
    "SMO": (1563.0625, [1455, 1341, 790, 617, 1172, 3134, 2983, 3055]),
    "plane wing": (946.375, [1796, 1389, 500, 449, 1018, 2076, 2079, 2768]),
    "other plane wing": (963.5625, [1562, 1202, 439, 697, 996, 1936, 1596, 2678]),
    "bruised tarp": (1828.0, [2257, 2227, 1112, 992, 1155, 1269, 4218, 4890]),
    "tarp in haze": (1748.3125, [2458, 2435, 1225, 1220, 1288, 1458, 5132, 5547]),
    "peaked tarp": (1923.75, [3322, 3943, 1897, 1623, 1684, 1828, 5647, 6194]),
    "rect tent": (1060.8125, [1231, 1175, 705, 744, 729, 883, 3457, 4074]),
    "rect tent 2": (1125.4375, [1326, 1345, 673, 673, 582, 857, 3573, 4112]),
    "humpback tent": (570.3125, [1105, 1278, 701, 493, 525, 656, 1952, 2332]),
    "humpback tent 2": (806.375, [1413, 1935, 879, 653, 678, 868, 2726, 3632]),
    "NE of ISTC": (787.125, [1477, 1894, 809, 552, 588, 771, 2455, 3306]),
    "MGR tank": (5744.6875, [813, 862, 1001, 4350, 7946, 8378, 8454, 9586]),
    "MGR tennis ct": (1595.5, [1010, 1024, 1570, 1186, 1382, 1891, 3416, 4833]),
    "USM roof": (7332.375, [5541, 6504, 6731, 7129, 7500, 7635, 7434, 7553]),
    "USM roof 2": (7027.0625, [5493, 6163, 6454, 6887, 7233, 7419, 7123, 7261]),
    "USM roof 3": (7856.3125, [6311, 7337, 7642, 7782, 8185, 8174, 7935, 7908]),
    "bright roof": (9299.8125, [7268, 8581, 8916, 9078, 9507, 9573, 8776, 9113]),
    "bright roof 2": (9865.3125, [8985, 10000, 10000, 10000, 10000, 10000, 8990, 10000]),
    "bright roof 3": (8545.125, [7078, 8360, 8612, 8646, 9057, 9136, 8510, 8619]),
    "bright roof 4": (6868.125, [6243, 6566, 6507, 6576, 6855, 6962, 6601, 6658]),
    "Gold Gym": (6765.5, [5656, 6230, 6321, 6638, 6890, 7114, 6974, 7078]),
    "Gold Gym 2": (8129.3125, [6552, 7640, 7910, 8011, 8387, 8405, 8377, 8457]),
    "SM pier roof": (4414.875, [989, 1234, 3769, 4608, 4970, 5055, 5027, 5183]),


}

pans = torch.tensor(list(c[0] for c in colors.values())) / 10_000.0
muls = torch.tensor(list(c[1] for c in colors.values())) / 10_000.0

for n in range(len(colors.keys())):
    p = pans[n]
    pan = torch.zeros((full_edge, full_edge)) + p
    m = muls[n]
    mul = torch.zeros((8, full_edge // 4, full_edge // 4)) + m.unsqueeze(1).unsqueeze(1)

    # make y the target image
    y = b2l(m.unsqueeze(1).unsqueeze(1))
    y = torch.zeros((3, full_edge, full_edge)) + y

    pack = torch.cat([pile(pan.unsqueeze(0), 4), mul])
    xy = (pack, y)
    torch.save(xy, f"colors/{n}.pt")
